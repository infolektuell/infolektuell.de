name: Deploy

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Build and Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›’ Checkout
        uses: actions/checkout@v4
      - name: âœ¨ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
      - name: ðŸ› ï¸ Install deps
        run: npm ci
      - name: ðŸ› ï¸ Build
        run: npm run build
      - name: ðŸ” Create Key File
        run: install -m 600 -D /dev/null ~/.ssh/id_rsa
      - name: ðŸ”‘ Populate Key
        run: echo "${{ secrets.PRIVATE_SSH_KEY }}" > ~/.ssh/id_rsa
      - name: ðŸ” Load host keys
        run: echo "${{ secrets.KNOWN_HOSTS }}" > ~/.ssh/known_hosts
      - name: ðŸš€ Upload
        run: |
          rsync --archive --delete --stats -e 'ssh' dist/ "${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:${{ secrets.SSH_PATH }}"
